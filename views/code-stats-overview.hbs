{{!< layout}}

<div id="code-stats-overview">
    <div class="stats-overview">
        <div class="stats-switcher">
            <ol class="repo-stats">
                <li>
                    <a href="https://bitbucket.org/{{repoPath}}/commits" target="_top">
                        <i class="aui-icon aui-icon-small aui-iconfont-devtools-commit"></i>
                        <span class="number">{{codeStats.commitCount}}</span> commits
                    </a>
                </li>
                <li>
                    <a href="https://bitbucket.org/{{repoPath}}/addon/bitbucket-graphs/graphs-repo-page" target="_top">
                        <i class="aui-icon aui-icon-small aui-iconfont-admin-roles"></i>
                        <span class="number">{{codeStats.contributors.length}}</span>
                        {{#if codeStats.singleContributor}}contributor{{else}}contributors{{/if}}
                    </a>
                </li>
            </ol>
            {{#if codeStats.languages}}
                <ol class="languages-stats">
                    {{#each codeStats.languages}}
                        <li>
                            <a>
                                <span class="lang-color" style="background: {{langColor}};"></span>
                                <span class="lang">{{lang}}</span>
                                <span class="percent">{{percent}}</span>
                            </a>
                        </li>
                    {{/each}}
                </ol>
            {{/if}}
        </div>
    </div>
    {{#if codeStats.languages}}
        <div class="languages-graph">
            {{#each codeStats.languages}}
                <div class="lang-color" style="background: {{langColor}}; width: {{percent}}"></div>
            {{/each}}
        </div>
    {{/if}}
</div>

{{#if codeStats.languages}}
    <script>
        $(document).on('ready', function () {
            var othersPercent = 0;
            var $othersLanguages = $('#code-stats-overview .languages-stats li:nth-child(n+6)');

            $othersLanguages.each(function () {
                var $li = $(this).hide();
                var $liPercent = $li.find('a .percent').text();
                othersPercent += parseFloat($liPercent);
            });

            if ($othersLanguages.length) {
                $('#code-stats-overview .languages-stats li:nth-child(5)').after(
                    '<li>'                                                                    +
                        '<a>'                                                                 +
                            '<span class="lang-color" style="background: #cccccc;"></span>'   +
                            '<span class="lang">Others</span>'                                +
                            '<span class="percent">' + othersPercent + '%</span>'             +
                        '</a>'                                                                +
                    '</li>'
                );
            }
        });

        $('.languages-graph').on('click', function () {
            $('.stats-switcher').toggleClass('show-language-stats');
        });
    </script>
{{/if}}